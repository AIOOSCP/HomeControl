meta:
  name: PiGPIO
  description: Contains an adapter for PiGPIO
  author: Lennart K

requirements:
  - "pigpio"

items:
  PiGPIOAdapter:
    config_fields:
      host:
        type: String
        default: "localhost"

      port:
        type: Integer
        default: 8888

    config_schema:
      !vol/Required {schema: host, default: localhost}:
        !type/str

      !vol/Required {schema: port, default: 8888}:
        !vol/Coerce { type: !type/int }

  BinarySwitch:
    config_fields:
      pin:
        type: Integer
        default: 8

      on_state:
        type: Boolean
        default: True

      pigpio_adapter:
        default: None

    config_schema:
      !vol/Required {schema: pin, default: 16}:
        !vol/All
          - !vol/Coerce { type: !type/int }
          - !vol/Range { min: 2, max: 40 }

      !vol/Required {schema: on_state, default: True}:
        !vol/All
          - !vol/Any [ !type/bool , !type/int ]
          - !vol/Coerce { type: !type/bool }

      !vol/Required {schema: pigpio_adapter}:
        !type/str


    state:
      "on":
        setter: set_on
        default: False

    actions:
      toggle: toggle_on

  Button:
    config_fields:
      pin:
        type: Integer
        default: 8

      pigpio_adapter:
        default: None

      pull_up:
        type: Boolean
        default: True

      toggle:
        type: Boolean
        default: False

    config_schema:
      !vol/Required {schema: pin, default: 16}:
          !vol/All
            - !vol/Coerce { type: !type/int }
            - !vol/Range { min: 2, max: 40 }

      !vol/Required {schema: pigpio_adapter}:
        !type/str

      !vol/Required {schema: pull_up, default: True}:
        !vol/All
          - !vol/Any [ !type/bool , !type/int ]
          - !vol/Coerce { type: !type/bool }

      !vol/Required {schema: toggle, default: False}:
        !vol/All
          - !vol/Any [ !type/bool , !type/int ]
          - !vol/Coerce { type: !type/bool }

    state:
      value:
        default: 0

  I2CLCD:
    config_fields:
      pigpio_adapter:
          default: None

      bus:
        type: Integer
        default: 0

      address:
        type: Integer
        default: 0x27

    config_schema:
      !vol/Required {schema: pigpio_adapter}:
        !type/str
      
      !vol/Required {schema: bus, default: 0}:
        !vol/Coerce { type: !type/int }
      
      !vol/Required {schema: address, default: 0x27}:
        !vol/Coerce { type: !type/int }

    state:
      backlight:
        type: Boolean
        default: True
        setter: set_backlight

      line1:
        type: String
        default: HomeControl
        setter: set_line1

      line2:
        type: String
        default: HomeControl
        setter: set_line2
